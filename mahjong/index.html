<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éº»å°†æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #1a5f3f 0%, #0d3d26 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        h1 {
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            font-size: 2.5em;
        }

        .game-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 1200px;
            width: 100%;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            color: white;
            font-size: 1.1em;
        }

        .player-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 15px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .player-name {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .tiles-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
            min-height: 100px;
        }

        .tile {
            width: 50px;
            height: 70px;
            background: linear-gradient(145deg, #fff 0%, #f0f0f0 100%);
            border: 2px solid #888;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3),
                        inset 0 1px 0 rgba(255, 255, 255, 0.8);
            position: relative;
            user-select: none;
        }

        .tile:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.4),
                        inset 0 1px 0 rgba(255, 255, 255, 0.8);
        }

        .tile.selected {
            transform: translateY(-15px);
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        .tile-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1;
        }

        .tile-number {
            font-size: 1.4em;
        }

        .tile-suit {
            font-size: 0.9em;
            margin-top: 2px;
        }

        /* ç‰Œçš„é¢œè‰² */
        .tile-wan { color: #c41e3a; }
        .tile-tiao { color: #228b22; }
        .tile-tong { color: #1e90ff; }
        .tile-feng { color: #000; }
        .tile-jian { color: #8b0000; }

        .tile-back {
            background: linear-gradient(145deg, #2c5f4a 0%, #1a3d2d 100%);
            border-color: #1a3d2d;
            color: transparent;
        }

        .tile-back::after {
            content: '';
            width: 30px;
            height: 50px;
            background: repeating-linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.1),
                rgba(255, 255, 255, 0.1) 2px,
                transparent 2px,
                transparent 8px
            );
            border-radius: 3px;
        }

        .discarded-area {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            min-height: 120px;
            margin: 15px 0;
        }

        .discarded-area h3 {
            color: #ffd700;
            margin-bottom: 10px;
            text-align: center;
        }

        .discarded-tiles {
            display: flex;
            flex-wrap: wrap;
            gap: 3px;
            justify-content: center;
        }

        .discarded-tiles .tile {
            width: 40px;
            height: 56px;
            font-size: 1em;
            cursor: default;
        }

        .discarded-tiles .tile:hover {
            transform: none;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .btn-primary {
            background: linear-gradient(145deg, #ffd700 0%, #ffaa00 100%);
            color: #1a3d2d;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(145deg, #4a90e2 0%, #357abd 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.6);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .message {
            text-align: center;
            color: #ffd700;
            font-size: 1.3em;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 10px 0;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .meld-area {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .meld {
            display: flex;
            gap: 2px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .meld .tile {
            width: 40px;
            height: 56px;
            font-size: 1em;
            cursor: default;
        }

        .ai-thinking {
            color: #4a90e2;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .tile {
                width: 40px;
                height: 56px;
                font-size: 1em;
            }

            .tile-number {
                font-size: 1.1em;
            }

            .tile-suit {
                font-size: 0.7em;
            }

            .discarded-tiles .tile {
                width: 32px;
                height: 45px;
                font-size: 0.8em;
            }

            h1 {
                font-size: 1.8em;
            }

            .game-container {
                padding: 15px;
            }

            .btn {
                padding: 10px 20px;
                font-size: 1em;
            }
        }

        .winner-animation {
            animation: winPulse 0.5s ease-in-out infinite alternate;
        }

        @keyframes winPulse {
            from {
                transform: scale(1);
            }
            to {
                transform: scale(1.1);
            }
        }
    </style>
</head>
<body>
    <h1>ğŸ€„ éº»å°†æ¸¸æˆ ğŸ€„</h1>

    <div class="game-container">
        <div class="game-info">
            <div>å›åˆ: <span id="round">0</span></div>
            <div>å‰©ä½™ç‰Œ: <span id="remaining">0</span></div>
        </div>

        <div class="message" id="message">ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"å¼€å§‹</div>

        <!-- AI ç©å®¶ 2 (ä¸Šæ–¹) -->
        <div class="player-area" id="player2-area">
            <div class="player-name">ç”µè„‘ 2</div>
            <div class="meld-area" id="player2-melds"></div>
            <div class="tiles-container" id="player2-hand"></div>
        </div>

        <!-- ä¸­é—´åŒºåŸŸ -->
        <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
            <!-- AI ç©å®¶ 1 (å·¦ä¾§) -->
            <div class="player-area" id="player1-area" style="min-width: 250px;">
                <div class="player-name">ç”µè„‘ 1</div>
                <div class="meld-area" id="player1-melds"></div>
                <div class="tiles-container" id="player1-hand"></div>
            </div>

            <!-- å¼ƒç‰ŒåŒº -->
            <div class="discarded-area">
                <h3>å¼ƒç‰ŒåŒº</h3>
                <div class="discarded-tiles" id="discarded-tiles"></div>
            </div>

            <!-- AI ç©å®¶ 3 (å³ä¾§) -->
            <div class="player-area" id="player3-area" style="min-width: 250px;">
                <div class="player-name">ç”µè„‘ 3</div>
                <div class="meld-area" id="player3-melds"></div>
                <div class="tiles-container" id="player3-hand"></div>
            </div>
        </div>

        <!-- ç©å®¶ (ä¸‹æ–¹) -->
        <div class="player-area" id="player0-area">
            <div class="player-name">ä½ </div>
            <div class="meld-area" id="player0-melds"></div>
            <div class="tiles-container" id="player0-hand"></div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" id="startBtn" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
            <button class="btn btn-secondary" id="drawBtn" onclick="drawTile()" disabled>æ‘¸ç‰Œ</button>
            <button class="btn btn-secondary" id="discardBtn" onclick="discardTile()" disabled>æ‰“å‡ºé€‰ä¸­ç‰Œ</button>
            <button class="btn btn-primary" id="huBtn" onclick="declareHu()" disabled>èƒ¡ç‰Œ</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            deck: [],
            players: [
                { hand: [], melds: [], isHuman: true },
                { hand: [], melds: [], isHuman: false },
                { hand: [], melds: [], isHuman: false },
                { hand: [], melds: [], isHuman: false }
            ],
            discardedTiles: [],
            currentPlayer: 0,
            selectedTile: null,
            round: 0,
            gameOver: false,
            lastDiscarded: null
        };

        // éº»å°†ç‰Œå®šä¹‰
        const suits = {
            wan: { name: 'ä¸‡', class: 'tile-wan', tiles: ['ä¸€ä¸‡', 'äºŒä¸‡', 'ä¸‰ä¸‡', 'å››ä¸‡', 'äº”ä¸‡', 'å…­ä¸‡', 'ä¸ƒä¸‡', 'å…«ä¸‡', 'ä¹ä¸‡'] },
            tiao: { name: 'æ¡', class: 'tile-tiao', tiles: ['ä¸€æ¡', 'äºŒæ¡', 'ä¸‰æ¡', 'å››æ¡', 'äº”æ¡', 'å…­æ¡', 'ä¸ƒæ¡', 'å…«æ¡', 'ä¹æ¡'] },
            tong: { name: 'ç­’', class: 'tile-tong', tiles: ['ä¸€ç­’', 'äºŒç­’', 'ä¸‰ç­’', 'å››ç­’', 'äº”ç­’', 'å…­ç­’', 'ä¸ƒç­’', 'å…«ç­’', 'ä¹ç­’'] }
        };

        const honorTiles = [
            { name: 'ä¸œé£', class: 'tile-feng' },
            { name: 'å—é£', class: 'tile-feng' },
            { name: 'è¥¿é£', class: 'tile-feng' },
            { name: 'åŒ—é£', class: 'tile-feng' },
            { name: 'çº¢ä¸­', class: 'tile-jian' },
            { name: 'å‘è´¢', class: 'tile-jian' },
            { name: 'ç™½æ¿', class: 'tile-jian' }
        ];

        // åˆ›å»ºå®Œæ•´çš„éº»å°†ç‰Œç»„
        function createDeck() {
            let deck = [];
            let id = 0;

            // æ•°ç‰Œ (ä¸‡ã€æ¡ã€ç­’)
            for (let suitName in suits) {
                const suit = suits[suitName];
                for (let i = 0; i < 4; i++) { // æ¯ç§ç‰Œ4å¼ 
                    for (let j = 0; j < suit.tiles.length; j++) {
                        deck.push({
                            id: id++,
                            name: suit.tiles[j],
                            suit: suitName,
                            number: j + 1,
                            class: suit.class,
                            displayName: `${j + 1}${suit.name}`
                        });
                    }
                }
            }

            // å­—ç‰Œ (é£ç‰Œå’Œç®­ç‰Œ)
            for (let i = 0; i < 4; i++) {
                honorTiles.forEach((tile, index) => {
                    deck.push({
                        id: id++,
                        name: tile.name,
                        suit: 'honor',
                        number: index + 1,
                        class: tile.class,
                        displayName: tile.name
                    });
                });
            }

            return deck;
        }

        // æ´—ç‰Œ
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }

        // åˆ›å»ºç‰Œçš„ HTML
        function createTileHTML(tile, isBack = false, isSelected = false) {
            if (isBack) {
                return `<div class="tile tile-back"></div>`;
            }

            const selectedClass = isSelected ? 'selected' : '';
            const content = tile.suit === 'honor' ?
                `<div class="tile-content"><div class="tile-number">${tile.name}</div></div>` :
                `<div class="tile-content"><div class="tile-number">${tile.number}</div><div class="tile-suit">${suits[tile.suit].name}</div></div>`;

            return `<div class="tile ${tile.class} ${selectedClass}" data-id="${tile.id}" onclick="selectTile(${tile.id})">${content}</div>`;
        }

        // æ’åºæ‰‹ç‰Œ
        function sortHand(hand) {
            return hand.sort((a, b) => {
                if (a.suit !== b.suit) {
                    const suitOrder = ['wan', 'tiao', 'tong', 'honor'];
                    return suitOrder.indexOf(a.suit) - suitOrder.indexOf(b.suit);
                }
                return a.number - b.number;
            });
        }

        // å‘ç‰Œ
        function dealCards() {
            gameState.deck = shuffleDeck(createDeck());

            // æ¯ä¸ªç©å®¶å‘13å¼ ç‰Œ
            for (let i = 0; i < 4; i++) {
                gameState.players[i].hand = [];
                gameState.players[i].melds = [];
                for (let j = 0; j < 13; j++) {
                    gameState.players[i].hand.push(gameState.deck.pop());
                }
                gameState.players[i].hand = sortHand(gameState.players[i].hand);
            }
        }

        // æ¸²æŸ“æ¸¸æˆç•Œé¢
        function render() {
            // æ¸²æŸ“ç©å®¶æ‰‹ç‰Œ
            gameState.players.forEach((player, index) => {
                const handElement = document.getElementById(`player${index}-hand`);
                const meldsElement = document.getElementById(`player${index}-melds`);

                if (player.isHuman) {
                    handElement.innerHTML = player.hand.map(tile =>
                        createTileHTML(tile, false, gameState.selectedTile === tile.id)
                    ).join('');
                } else {
                    // AI æ‰‹ç‰ŒèƒŒé¢
                    handElement.innerHTML = player.hand.map(() =>
                        createTileHTML(null, true)
                    ).join('');
                }

                // æ¸²æŸ“æ˜ç‰Œç»„
                meldsElement.innerHTML = player.melds.map(meld =>
                    `<div class="meld">${meld.map(tile => createTileHTML(tile)).join('')}</div>`
                ).join('');
            });

            // æ¸²æŸ“å¼ƒç‰ŒåŒº
            const discardedElement = document.getElementById('discarded-tiles');
            discardedElement.innerHTML = gameState.discardedTiles.map(tile =>
                createTileHTML(tile)
            ).join('');

            // æ›´æ–°æ¸¸æˆä¿¡æ¯
            document.getElementById('round').textContent = gameState.round;
            document.getElementById('remaining').textContent = gameState.deck.length;
        }

        // é€‰æ‹©ç‰Œ
        function selectTile(tileId) {
            if (gameState.gameOver || gameState.currentPlayer !== 0) return;

            const player = gameState.players[0];
            const tile = player.hand.find(t => t.id === tileId);

            if (tile) {
                gameState.selectedTile = gameState.selectedTile === tileId ? null : tileId;
                render();
            }
        }

        // æ‘¸ç‰Œ
        function drawTile() {
            if (gameState.gameOver || gameState.deck.length === 0) {
                setMessage('ç‰Œå·²æ‘¸å®Œï¼Œå¹³å±€ï¼');
                gameState.gameOver = true;
                return;
            }

            const currentPlayer = gameState.currentPlayer;
            const player = gameState.players[currentPlayer];

            if (player.hand.length >= 14) {
                setMessage('è¯·å…ˆæ‰“å‡ºä¸€å¼ ç‰Œ');
                return;
            }

            const tile = gameState.deck.pop();
            player.hand.push(tile);
            player.hand = sortHand(player.hand);

            render();
            updateButtons();

            if (currentPlayer === 0) {
                setMessage(`ä½ æ‘¸åˆ°äº†: ${tile.displayName}`);

                // æ£€æŸ¥æ˜¯å¦å¯ä»¥èƒ¡ç‰Œ
                if (canHu(player.hand)) {
                    document.getElementById('huBtn').disabled = false;
                    setMessage(`ä½ æ‘¸åˆ°äº†: ${tile.displayName} - å¯ä»¥èƒ¡ç‰Œï¼`);
                }
            }
        }

        // æ‰“å‡ºç‰Œ
        function discardTile() {
            if (gameState.gameOver) return;

            const currentPlayer = gameState.currentPlayer;
            const player = gameState.players[currentPlayer];

            let tileToDiscard;

            if (currentPlayer === 0) {
                // äººç±»ç©å®¶
                if (gameState.selectedTile === null) {
                    setMessage('è¯·å…ˆé€‰æ‹©ä¸€å¼ ç‰Œ');
                    return;
                }

                const tileIndex = player.hand.findIndex(t => t.id === gameState.selectedTile);
                if (tileIndex === -1) return;

                tileToDiscard = player.hand.splice(tileIndex, 1)[0];
                gameState.selectedTile = null;
            } else {
                // AI ç©å®¶
                tileToDiscard = aiSelectDiscard(player);
                const tileIndex = player.hand.findIndex(t => t.id === tileToDiscard.id);
                if (tileIndex !== -1) {
                    player.hand.splice(tileIndex, 1);
                }
            }

            gameState.discardedTiles.push(tileToDiscard);
            gameState.lastDiscarded = tileToDiscard;
            gameState.round++;

            render();

            // æ£€æŸ¥å…¶ä»–ç©å®¶æ˜¯å¦å¯ä»¥èƒ¡è¿™å¼ ç‰Œ
            if (checkOtherPlayersHu(tileToDiscard)) {
                return;
            }

            // ä¸‹ä¸€ä¸ªç©å®¶
            nextPlayer();
        }

        // AI é€‰æ‹©è¦æ‰“å‡ºçš„ç‰Œ
        function aiSelectDiscard(player) {
            // ç®€å•AIï¼šéšæœºé€‰æ‹©ä¸€å¼ ç‰Œ
            return player.hand[Math.floor(Math.random() * player.hand.length)];
        }

        // æ£€æŸ¥å…¶ä»–ç©å®¶æ˜¯å¦å¯ä»¥èƒ¡ç‰Œ
        function checkOtherPlayersHu(discardedTile) {
            for (let i = 0; i < 4; i++) {
                if (i === gameState.currentPlayer) continue;

                const player = gameState.players[i];
                const testHand = [...player.hand, discardedTile];

                if (canHu(testHand)) {
                    gameState.gameOver = true;
                    setMessage(`ç”µè„‘ ${i} èƒ¡ç‰Œäº†ï¼èƒ¡ç‰Œ: ${discardedTile.displayName}`);

                    // æ˜¾ç¤ºæ‰€æœ‰æ‰‹ç‰Œ
                    player.hand = testHand;
                    render();

                    setTimeout(() => {
                        if (confirm(`ç”µè„‘ ${i} èƒ¡ç‰Œäº†ï¼\næ˜¯å¦é‡æ–°å¼€å§‹ï¼Ÿ`)) {
                            startGame();
                        }
                    }, 1000);

                    return true;
                }
            }
            return false;
        }

        // ä¸‹ä¸€ä¸ªç©å®¶
        function nextPlayer() {
            gameState.currentPlayer = (gameState.currentPlayer + 1) % 4;

            updateButtons();

            if (gameState.currentPlayer === 0) {
                setMessage('è½®åˆ°ä½ æ‘¸ç‰Œ');
            } else {
                setMessage(`ç”µè„‘ ${gameState.currentPlayer} æ­£åœ¨æ€è€ƒ...`);
                setTimeout(() => aiTurn(), 1000);
            }
        }

        // AI å›åˆ
        function aiTurn() {
            if (gameState.gameOver) return;

            const player = gameState.players[gameState.currentPlayer];

            // æ‘¸ç‰Œ
            if (gameState.deck.length > 0) {
                const tile = gameState.deck.pop();
                player.hand.push(tile);
                player.hand = sortHand(player.hand);
                render();

                // æ£€æŸ¥æ˜¯å¦å¯ä»¥èƒ¡ç‰Œ
                if (canHu(player.hand)) {
                    gameState.gameOver = true;
                    setMessage(`ç”µè„‘ ${gameState.currentPlayer} è‡ªæ‘¸èƒ¡ç‰Œï¼`);

                    // æ˜¾ç¤ºæ‰€æœ‰æ‰‹ç‰Œ
                    const handElement = document.getElementById(`player${gameState.currentPlayer}-hand`);
                    handElement.innerHTML = player.hand.map(t => createTileHTML(t)).join('');

                    setTimeout(() => {
                        if (confirm(`ç”µè„‘ ${gameState.currentPlayer} è‡ªæ‘¸èƒ¡ç‰Œï¼\næ˜¯å¦é‡æ–°å¼€å§‹ï¼Ÿ`)) {
                            startGame();
                        }
                    }, 1000);

                    return;
                }
            } else {
                setMessage('ç‰Œå·²æ‘¸å®Œï¼Œå¹³å±€ï¼');
                gameState.gameOver = true;
                return;
            }

            // æ‰“å‡ºä¸€å¼ ç‰Œ
            setTimeout(() => discardTile(), 500);
        }

        // æ£€æŸ¥æ˜¯å¦å¯ä»¥èƒ¡ç‰Œï¼ˆç®€åŒ–ç‰ˆï¼‰
        function canHu(hand) {
            if (hand.length !== 14) return false;

            // ç®€åŒ–çš„èƒ¡ç‰Œåˆ¤æ–­ï¼šæ£€æŸ¥æ˜¯å¦æœ‰3ä¸ªåˆ»å­æˆ–é¡ºå­åŠ ä¸€å¯¹å°†
            const sortedHand = [...hand].sort((a, b) => {
                if (a.suit !== b.suit) return a.suit.localeCompare(b.suit);
                return a.number - b.number;
            });

            return tryHu(sortedHand);
        }

        // å°è¯•èƒ¡ç‰Œç»„åˆ
        function tryHu(tiles) {
            if (tiles.length === 2) {
                // å‰©ä¸¤å¼ ç‰Œï¼Œå¿…é¡»æ˜¯ç›¸åŒçš„ç‰Œï¼ˆå°†ï¼‰
                return tiles[0].name === tiles[1].name;
            }

            // å°è¯•æ‰¾ä¸€ä¸ªå°†å¹¶é€’å½’æ£€æŸ¥
            for (let i = 0; i < tiles.length - 1; i++) {
                if (tiles[i].name === tiles[i + 1].name) {
                    const remaining = tiles.filter((_, index) => index !== i && index !== i + 1);
                    if (tryRemoveSets(remaining)) {
                        return true;
                    }
                }
            }

            return false;
        }

        // å°è¯•ç§»é™¤åˆ»å­æˆ–é¡ºå­
        function tryRemoveSets(tiles) {
            if (tiles.length === 0) return true;

            // å°è¯•ç§»é™¤åˆ»å­ï¼ˆä¸‰å¼ ç›¸åŒçš„ç‰Œï¼‰
            if (tiles.length >= 3) {
                if (tiles[0].name === tiles[1].name && tiles[1].name === tiles[2].name) {
                    return tryRemoveSets(tiles.slice(3));
                }

                // å°è¯•ç§»é™¤é¡ºå­ï¼ˆä¸‰å¼ è¿ç»­çš„ç‰Œï¼Œä»…é™æ•°ç‰Œï¼‰
                if (tiles[0].suit !== 'honor') {
                    const sameSuit = tiles.filter(t => t.suit === tiles[0].suit);
                    const num1 = tiles[0].number;
                    const num2Index = sameSuit.findIndex(t => t.number === num1 + 1);
                    const num3Index = sameSuit.findIndex(t => t.number === num1 + 2);

                    if (num2Index !== -1 && num3Index !== -1) {
                        const tile2 = sameSuit[num2Index];
                        const tile3 = sameSuit[num3Index];

                        const remaining = [...tiles];
                        const idx0 = remaining.findIndex(t => t.id === tiles[0].id);
                        remaining.splice(idx0, 1);
                        const idx2 = remaining.findIndex(t => t.id === tile2.id);
                        remaining.splice(idx2, 1);
                        const idx3 = remaining.findIndex(t => t.id === tile3.id);
                        remaining.splice(idx3, 1);

                        return tryRemoveSets(remaining);
                    }
                }
            }

            return false;
        }

        // èƒ¡ç‰Œ
        function declareHu() {
            if (gameState.gameOver) return;

            const player = gameState.players[0];
            if (canHu(player.hand)) {
                gameState.gameOver = true;
                setMessage('æ­å–œï¼ä½ èƒ¡ç‰Œäº†ï¼ğŸ‰');

                const handElement = document.getElementById('player0-hand');
                handElement.classList.add('winner-animation');

                setTimeout(() => {
                    handElement.classList.remove('winner-animation');
                    if (confirm('æ­å–œï¼ä½ èƒ¡ç‰Œäº†ï¼\næ˜¯å¦é‡æ–°å¼€å§‹ï¼Ÿ')) {
                        startGame();
                    }
                }, 1000);
            } else {
                setMessage('è¿˜ä¸èƒ½èƒ¡ç‰Œ');
            }
        }

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtons() {
            const isHumanTurn = gameState.currentPlayer === 0 && !gameState.gameOver;
            const hasDrawn = gameState.players[0].hand.length === 14;

            document.getElementById('drawBtn').disabled = !isHumanTurn || hasDrawn;
            document.getElementById('discardBtn').disabled = !isHumanTurn || !hasDrawn;
            document.getElementById('huBtn').disabled = !canHu(gameState.players[0].hand);
        }

        // è®¾ç½®æ¶ˆæ¯
        function setMessage(msg) {
            document.getElementById('message').textContent = msg;
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            gameState = {
                deck: [],
                players: [
                    { hand: [], melds: [], isHuman: true },
                    { hand: [], melds: [], isHuman: false },
                    { hand: [], melds: [], isHuman: false },
                    { hand: [], melds: [], isHuman: false }
                ],
                discardedTiles: [],
                currentPlayer: 0,
                selectedTile: null,
                round: 0,
                gameOver: false,
                lastDiscarded: null
            };

            dealCards();
            render();
            updateButtons();
            setMessage('æ¸¸æˆå¼€å§‹ï¼è¯·æ‘¸ç‰Œ');

            document.getElementById('startBtn').textContent = 'é‡æ–°å¼€å§‹';
        }

        // åˆå§‹åŒ–
        render();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="screen-orientation" content="landscape">
    <title>éº»å°†æ¸¸æˆ - å››æ–¹å¯¹æˆ˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #1a5f3f 0%, #0d3d26 100%);
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            touch-action: none;
        }

        /* ç«–å±æç¤º */
        .rotate-hint {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #1a5f3f 0%, #0d3d26 100%);
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #ffd700;
        }

        .rotate-hint svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            animation: rotate-icon 2s infinite;
        }

        @keyframes rotate-icon {
            0%, 100% { transform: rotate(-90deg); }
            50% { transform: rotate(90deg); }
        }

        @media (orientation: portrait) {
            .rotate-hint { display: flex; }
            .game-table { display: none; }
        }

        /* æ¸¸æˆæ¡Œå° */
        .game-table {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ä¸­å¤®å¼ƒç‰ŒåŒº */
        .discard-zone {
            position: absolute;
            width: 40vw;
            height: 35vh;
            background: rgba(0, 0, 0, 0.2);
            border: 3px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 4px;
            padding: 10px;
            z-index: 10;
        }

        .discard-slot {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .discard-slot .tile {
            width: 100%;
            height: 100%;
            font-size: 0.9em;
        }

        /* ç©å®¶åŒºåŸŸ */
        .player {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .player-name {
            color: #ffd700;
            font-weight: bold;
            font-size: 1em;
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            white-space: nowrap;
        }

        .player-hand {
            display: flex;
            gap: 3px;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px;
            border-radius: 8px;
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 45vw;
            scrollbar-width: none;
        }

        .player-hand::-webkit-scrollbar { display: none; }

        /* ä¸‹æ–¹ç©å®¶ï¼ˆè‡ªå·±ï¼‰ */
        .player-bottom {
            bottom: 8vh;
            left: 50%;
            transform: translateX(-50%);
        }

        .player-bottom .player-hand {
            flex-direction: row;
            max-width: 60vw;
        }

        /* ä¸Šæ–¹ç©å®¶ï¼ˆå¯¹å®¶ï¼‰ */
        .player-top {
            top: 2vh;
            left: 50%;
            transform: translateX(-50%) rotate(180deg);
        }

        /* å·¦ä¾§ç©å®¶ */
        .player-left {
            left: 2vw;
            top: 50%;
            transform: translateY(-50%) rotate(90deg);
            transform-origin: center;
        }

        /* å³ä¾§ç©å®¶ */
        .player-right {
            right: 2vw;
            top: 50%;
            transform: translateY(-50%) rotate(-90deg);
            transform-origin: center;
        }

        /* éº»å°†ç‰Œ */
        .tile {
            width: 45px;
            height: 62px;
            background: linear-gradient(145deg, #fff 0%, #f0f0f0 100%);
            border: 2px solid #888;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.8);
            flex-shrink: 0;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .tile:hover {
            transform: translateY(-8px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.5);
        }

        .tile.selected {
            transform: translateY(-15px);
            box-shadow: 0 8px 16px rgba(255, 215, 0, 0.6);
            border-color: #ffd700;
        }

        .tile-number { font-size: 1.1em; }
        .tile-suit { font-size: 0.7em; }

        /* ä¸‡ - çº¢è‰² */
        .tile[data-type="wan"] .tile-number { color: #c00; }
        /* ç­’ - è“è‰² */
        .tile[data-type="tong"] .tile-number { color: #0066cc; }
        /* æ¡ - ç»¿è‰² */
        .tile[data-type="tiao"] .tile-number { color: #008000; }
        /* é£ç‰Œ - é»‘è‰² */
        .tile[data-type="feng"] { color: #000; }
        /* ç®­ç‰Œ */
        .tile[data-type="jian"][data-value="ä¸­"] .tile-number { color: #c00; }
        .tile[data-type="jian"][data-value="å‘"] .tile-number { color: #008000; }
        .tile[data-type="jian"][data-value="ç™½"] .tile-number { color: #0066cc; }

        /* æ§åˆ¶æŒ‰é’® */
        .controls {
            position: absolute;
            bottom: 2vh;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            border-radius: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .btn:active { transform: scale(0.95); }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* æ¸¸æˆä¿¡æ¯ */
        .game-info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 0.9em;
            background: rgba(0,0,0,0.5);
            padding: 10px 15px;
            border-radius: 8px;
            z-index: 100;
        }

        .game-info div { margin: 5px 0; }

        /* å½“å‰æ‘¸ç‰ŒæŒ‡ç¤º */
        .current-draw {
            position: absolute;
            bottom: 8vh;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 100;
        }

        .current-draw .tile {
            width: 55px;
            height: 75px;
            font-size: 1.3em;
            animation: drawPulse 1s infinite;
        }

        @keyframes drawPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .draw-label {
            color: #ffd700;
            font-size: 0.9em;
            margin-top: 5px;
        }

        /* èƒ¡ç‰Œæç¤º */
        .win-notice {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px 50px;
            border-radius: 20px;
            font-size: 2em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            animation: winPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes winPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        /* å…¶ä»–ç©å®¶å¼ƒç‰Œï¼ˆä¾§é¢æ˜¾ç¤ºï¼‰ */
        .player-discards {
            position: absolute;
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            max-width: 150px;
        }

        .player-discards .tile {
            width: 28px;
            height: 38px;
            font-size: 0.7em;
        }

        .player-left .player-discards { right: -120px; top: 0; }
        .player-right .player-discards { left: -120px; top: 0; }
        .player-top .player-discards { bottom: -50px; }
        .player-bottom .player-discards { top: -50px; }
    </style>
</head>
<body>
    <div class="rotate-hint">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M16.48 2.52c3.27 1.55 5.61 4.72 5.97 8.48h1.5A8.25 8.25 0 0018 3.75V2.52zM2.25 12c0 3.27 1.8 6.12 4.48 7.68l.75-1.3a6.75 6.75 0 01-3.48-5.88H2.25zm1.5 0a6.75 6.75 0 019-6.36V4.19a8.25 8.25 0 00-9 7.81h1.5z"/>
        </svg>
        <div>è¯·æ—‹è½¬è®¾å¤‡ä¸ºæ¨ªå±</div>
    </div>

    <div class="game-table">
        <!-- æ¸¸æˆä¿¡æ¯ -->
        <div class="game-info">
            <div>ğŸ€„ å‰©ä½™ç‰Œï¼š<span id="remainingTiles">136</span></div>
            <div>ğŸ“¤ å·²æ‰“ï¼š<span id="discardedCount">0</span></div>
            <div>ğŸ® å½“å‰ï¼š<span id="currentPlayer">ç©å®¶ 1</span></div>
        </div>

        <!-- ä¸Šæ–¹ç©å®¶ï¼ˆç”µè„‘ 2ï¼‰ -->
        <div class="player player-top" id="player2">
            <div class="player-name">ç”µè„‘ 2 (å¯¹å®¶)</div>
            <div class="player-hand" id="hand2"></div>
        </div>

        <!-- å·¦ä¾§ç©å®¶ï¼ˆç”µè„‘ 1ï¼‰ -->
        <div class="player player-left" id="player1">
            <div class="player-name">ç”µè„‘ 1 (ä¸Šå®¶)</div>
            <div class="player-hand" id="hand1"></div>
        </div>

        <!-- å³ä¾§ç©å®¶ï¼ˆç”µè„‘ 3ï¼‰ -->
        <div class="player player-right" id="player3">
            <div class="player-name">ç”µè„‘ 3 (ä¸‹å®¶)</div>
            <div class="player-hand" id="hand3"></div>
        </div>

        <!-- ä¸­å¤®å¼ƒç‰ŒåŒº -->
        <div class="discard-zone" id="discardZone"></div>

        <!-- ä¸‹æ–¹ç©å®¶ï¼ˆè‡ªå·±ï¼‰ -->
        <div class="player player-bottom" id="player0">
            <div class="player-name">ğŸ¯ ä½ </div>
            <div class="player-hand" id="hand0"></div>
        </div>

        <!-- å½“å‰æ‘¸çš„ç‰Œ -->
        <div class="current-draw" id="currentDraw" style="display: none;">
            <div class="tile" id="currentDrawTile"></div>
            <div class="draw-label">æ‘¸åˆ°çš„ç‰Œ</div>
        </div>

        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="controls">
            <button class="btn btn-primary" id="drawBtn" onclick="drawTile()">æ‘¸ç‰Œ</button>
            <button class="btn btn-warning" id="playSelectedBtn" onclick="playSelected()" disabled>æ‰“å‡ºé€‰ä¸­</button>
            <button class="btn btn-success" id="winBtn" onclick="declareWin()" disabled>ğŸ‰ èƒ¡ç‰Œ</button>
            <button class="btn btn-primary" onclick="newGame()">æ–°æ¸¸æˆ</button>
        </div>

        <!-- èƒ¡ç‰Œæç¤º -->
        <div class="win-notice" id="winNotice">ğŸ‰ èƒ¡ç‰Œï¼</div>
    </div>

    <script>
        // ==================== éº»å°†æ¸¸æˆé€»è¾‘ ====================
        
        const TILE_TYPES = [
            // ä¸‡
            ...Array(9).fill(null).map((_, i) => ({ type: 'wan', value: String(i+1), display: ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'][i] + 'ä¸‡' })),
            // ç­’
            ...Array(9).fill(null).map((_, i) => ({ type: 'tong', value: String(i+1), display: ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'][i] + 'ç­’' })),
            // æ¡
            ...Array(9).fill(null).map((_, i) => ({ type: 'tiao', value: String(i+1), display: ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'][i] + 'æ¡' })),
            // é£ç‰Œ
            { type: 'feng', value: 'ä¸œ', display: 'ä¸œ' },
            { type: 'feng', value: 'å—', display: 'å—' },
            { type: 'feng', value: 'è¥¿', display: 'è¥¿' },
            { type: 'feng', value: 'åŒ—', display: 'åŒ—' },
            // ç®­ç‰Œ
            { type: 'jian', value: 'ä¸­', display: 'ä¸­' },
            { type: 'jian', value: 'å‘', display: 'å‘' },
            { type: 'jian', value: 'ç™½', display: 'ç™½' }
        ];

        let tileWall = [];
        let players = [[], [], [], []]; // 4 ä¸ªç©å®¶çš„æ‰‹ç‰Œ
        let discards = []; // å¼ƒç‰Œ
        let currentPlayer = 0; // å½“å‰ç©å®¶
        let selectedTileIndex = -1;
        let currentDraw = null; // å½“å‰æ‘¸çš„ç‰Œ

        // åˆ›å»ºç‰Œå¢™
        function createWall() {
            tileWall = [];
            TILE_TYPES.forEach(tile => {
                for (let i = 0; i < 4; i++) {
                    tileWall.push({ ...tile, id: Math.random() });
                }
            });
            shuffle(tileWall);
        }

        // æ´—ç‰Œ
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // å‘ç‰Œ
        function dealTiles() {
            players = [[], [], [], []];
            // æ¯äºº 13 å¼ 
            for (let i = 0; i < 13; i++) {
                for (let p = 0; p < 4; p++) {
                    players[p].push(tileWall.pop());
                }
            }
            currentPlayer = 0;
            currentDraw = null;
            discards = [];
        }

        // åˆ›å»ºç‰Œçš„ DOM
        function createTileElement(tile, index = -1) {
            const div = document.createElement('div');
            div.className = 'tile';
            div.dataset.type = tile.type;
            div.dataset.value = tile.value;
            
            if (tile.type === 'wan' || tile.type === 'tong' || tile.type === 'tiao') {
                div.innerHTML = `<span class="tile-number">${tile.display[0]}</span><span class="tile-suit">${tile.display.slice(1)}</span>`;
            } else {
                div.innerHTML = `<span class="tile-number">${tile.display}</span>`;
            }

            if (index >= 0) {
                div.onclick = () => selectTile(index);
            }
            return div;
        }

        // æ¸²æŸ“æ‰€æœ‰ç©å®¶æ‰‹ç‰Œ
        function renderHands() {
            for (let p = 0; p < 4; p++) {
                const container = document.getElementById(`hand${p}`);
                container.innerHTML = '';
                players[p].forEach((tile, i) => {
                    if (p === 0) { // åªæœ‰è‡ªå·±å¯ä»¥ç‚¹å‡»
                        const tileEl = createTileElement(tile, i);
                        if (i === selectedTileIndex) tileEl.classList.add('selected');
                        container.appendChild(tileEl);
                    } else {
                        // ç”µè„‘ç©å®¶çš„ç‰ŒèƒŒé¢æ˜¾ç¤º
                        const tileEl = document.createElement('div');
                        tileEl.className = 'tile';
                        tileEl.style.background = 'linear-gradient(145deg, #667eea 0%, #764ba2 100%)';
                        container.appendChild(tileEl);
                    }
                });
            }
            updateInfo();
        }

        // é€‰æ‹©ç‰Œ
        function selectTile(index) {
            selectedTileIndex = index;
            renderHands();
            document.getElementById('playSelectedBtn').disabled = false;
        }

        // æ‘¸ç‰Œ
        function drawTile() {
            if (tileWall.length === 0) {
                alert('ç‰Œå¢™å·²ç©ºï¼æµå±€ï¼');
                return;
            }
            if (currentPlayer !== 0) {
                alert('è¿˜æ²¡è½®åˆ°ä½ ï¼');
                return;
            }

            currentDraw = tileWall.pop();
            renderCurrentDraw();
            updateInfo();
        }

        // æ¸²æŸ“å½“å‰æ‘¸çš„ç‰Œ
        function renderCurrentDraw() {
            const container = document.getElementById('currentDraw');
            const tileEl = document.getElementById('currentDrawTile');
            
            if (currentDraw) {
                container.style.display = 'flex';
                tileEl.innerHTML = '';
                tileEl.dataset.type = currentDraw.type;
                tileEl.dataset.value = currentDraw.value;
                
                if (currentDraw.type === 'wan' || currentDraw.type === 'tong' || currentDraw.type === 'tiao') {
                    tileEl.innerHTML = `<span class="tile-number">${currentDraw.display[0]}</span><span class="tile-suit">${currentDraw.display.slice(1)}</span>`;
                } else {
                    tileEl.innerHTML = `<span class="tile-number">${currentDraw.display}</span>`;
                }
                
                tileEl.onclick = () => playCurrentDraw();
            } else {
                container.style.display = 'none';
            }
        }

        // æ‰“å‡ºå½“å‰æ‘¸çš„ç‰Œ
        function playCurrentDraw() {
            if (!currentDraw) return;
            discards.push(currentDraw);
            currentDraw = null;
            selectedTileIndex = -1;
            document.getElementById('currentDraw').style.display = 'none';
            document.getElementById('playSelectedBtn').disabled = true;
            renderDiscards();
            nextPlayer();
        }

        // æ‰“å‡ºæ‰‹ä¸­çš„ç‰Œ
        function playSelected() {
            if (selectedTileIndex < 0 || !players[0][selectedTileIndex]) return;
            
            const tile = players[0].splice(selectedTileIndex, 1)[0];
            discards.push(tile);
            selectedTileIndex = -1;
            document.getElementById('playSelectedBtn').disabled = true;
            renderHands();
            renderDiscards();
            nextPlayer();
        }

        // æ¸²æŸ“å¼ƒç‰ŒåŒº
        function renderDiscards() {
            const container = document.getElementById('discardZone');
            container.innerHTML = '';
            discards.forEach(tile => {
                const slot = document.createElement('div');
                slot.className = 'discard-slot';
                slot.appendChild(createTileElement(tile));
                container.appendChild(slot);
            });
            updateInfo();
        }

        // ä¸‹ä¸€ä¸ªç©å®¶
        function nextPlayer() {
            currentPlayer = (currentPlayer + 1) % 4;
            document.getElementById('currentPlayer').textContent = 
                ['ä½ ', 'ç”µè„‘ 1', 'ç”µè„‘ 2', 'ç”µè„‘ 3'][currentPlayer];
            
            if (currentPlayer !== 0) {
                // AI å›åˆ
                setTimeout(aiTurn, 1000);
            }
        }

        // AI å›åˆ
        function aiTurn() {
            if (tileWall.length > 0) {
                const drawn = tileWall.pop();
                // AI éšæœºæ‰“ä¸€å¼ 
                const discardIdx = Math.floor(Math.random() * players[currentPlayer].length);
                const discarded = players[currentPlayer].splice(discardIdx, 1)[0];
                discards.push(discarded);
                players[currentPlayer].push(drawn);
                renderDiscards();
                nextPlayer();
            }
        }

        // æ›´æ–°ä¿¡æ¯
        function updateInfo() {
            document.getElementById('remainingTiles').textContent = tileWall.length;
            document.getElementById('discardedCount').textContent = discards.length;
        }

        // èƒ¡ç‰Œ
        function declareWin() {
            document.getElementById('winNotice').style.display = 'block';
            setTimeout(() => {
                document.getElementById('winNotice').style.display = 'none';
            }, 3000);
        }

        // æ–°æ¸¸æˆ
        function newGame() {
            createWall();
            dealTiles();
            renderHands();
            renderDiscards();
            renderCurrentDraw();
            document.getElementById('winNotice').style.display = 'none';
            document.getElementById('playSelectedBtn').disabled = true;
            document.getElementById('winBtn').disabled = true;
            updateInfo();
        }

        // åˆå§‹åŒ–
        newGame();
    </script>
</body>
</html>

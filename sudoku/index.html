<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>æ•°ç‹¬æ¸¸æˆ - Sudoku</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            color: #333;
        }

        .container {
            max-width: 600px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: white;
            margin: 15px 0;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            flex-wrap: wrap;
            gap: 10px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            min-width: 80px;
        }

        .info-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .info-value.errors {
            color: #e74c3c;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            min-width: 100px;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        button:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-hint {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-check {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .difficulty-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .difficulty-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid white;
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .difficulty-btn.active {
            background: white;
            color: #667eea;
            transform: scale(1.05);
        }

        .sudoku-board {
            background: white;
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 15px;
            display: inline-block;
        }

        .sudoku-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 0;
            background: #333;
            border: 3px solid #333;
        }

        .cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: 1px solid #ddd;
            font-size: clamp(18px, 4vw, 28px);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        /* 3x3 å®«æ ¼åŠ ç²—è¾¹æ¡† */
        .cell:nth-child(3n) {
            border-right: 2px solid #333;
        }

        .cell:nth-child(n+19):nth-child(-n+27),
        .cell:nth-child(n+46):nth-child(-n+54) {
            border-bottom: 2px solid #333;
        }

        .cell.initial {
            background: #f0f0f0;
            color: #333;
            cursor: not-allowed;
            font-weight: 700;
        }

        .cell.selected {
            background: #667eea;
            color: white;
        }

        .cell.highlighted {
            background: #e8eaf6;
        }

        .cell.same-number {
            background: #c5cae9;
        }

        .cell.error {
            background: #ffebee;
            color: #e74c3c;
            animation: shake 0.3s;
        }

        .cell:not(.initial):hover {
            background: #f5f5f5;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .number-pad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .number-btn {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.5em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .number-btn:active {
            transform: scale(0.9);
        }

        .number-btn.clear {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            grid-column: span 2;
        }

        /* å®ŒæˆåŠ¨ç”» */
        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            text-align: center;
            z-index: 1000;
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popIn {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        .celebration h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 15px;
        }

        .celebration p {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f0f;
            position: absolute;
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 600px) {
            h1 {
                font-size: 1.5em;
                margin: 10px 0;
            }

            .game-info {
                padding: 10px;
            }

            .info-value {
                font-size: 1.2em;
            }

            button {
                padding: 10px 15px;
                font-size: 0.9em;
                min-width: 80px;
            }

            .sudoku-board {
                padding: 5px;
            }

            .number-pad {
                padding: 10px;
                gap: 8px;
            }

            .celebration {
                padding: 30px 20px;
            }

            .celebration h2 {
                font-size: 1.5em;
            }

            .celebration p {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ æ•°ç‹¬æ¸¸æˆ</h1>

        <div class="game-info">
            <div class="info-item">
                <div class="info-label">éš¾åº¦</div>
                <div class="info-value" id="difficultyDisplay">ç®€å•</div>
            </div>
            <div class="info-item">
                <div class="info-label">æ—¶é—´</div>
                <div class="info-value" id="timer">00:00</div>
            </div>
            <div class="info-item">
                <div class="info-label">é”™è¯¯</div>
                <div class="info-value errors" id="errors">0</div>
            </div>
        </div>

        <div class="difficulty-selector">
            <button class="difficulty-btn active" data-difficulty="easy">ç®€å•</button>
            <button class="difficulty-btn" data-difficulty="medium">ä¸­ç­‰</button>
            <button class="difficulty-btn" data-difficulty="hard">å›°éš¾</button>
        </div>

        <div class="controls">
            <button class="btn-primary" id="newGameBtn">æ–°æ¸¸æˆ</button>
            <button class="btn-hint" id="hintBtn">æç¤º</button>
            <button class="btn-check" id="checkBtn">æ£€æŸ¥</button>
        </div>

        <div class="sudoku-board">
            <div class="sudoku-grid" id="sudokuGrid"></div>
        </div>

        <div class="number-pad">
            <button class="number-btn" data-number="1">1</button>
            <button class="number-btn" data-number="2">2</button>
            <button class="number-btn" data-number="3">3</button>
            <button class="number-btn" data-number="4">4</button>
            <button class="number-btn" data-number="5">5</button>
            <button class="number-btn" data-number="6">6</button>
            <button class="number-btn" data-number="7">7</button>
            <button class="number-btn" data-number="8">8</button>
            <button class="number-btn" data-number="9">9</button>
            <button class="number-btn clear" data-number="0">æ¸…é™¤</button>
        </div>
    </div>

    <script>
        // ==================== æ•°ç‹¬æ¸¸æˆæ ¸å¿ƒé€»è¾‘ ====================

        class SudokuGame {
            constructor() {
                this.board = Array(9).fill(null).map(() => Array(9).fill(0));
                this.solution = Array(9).fill(null).map(() => Array(9).fill(0));
                this.initialBoard = Array(9).fill(null).map(() => Array(9).fill(0));
                this.selectedCell = null;
                this.difficulty = 'easy';
                this.errors = 0;
                this.startTime = null;
                this.timerInterval = null;

                this.difficultySettings = {
                    easy: { cellsToRemove: 35 },
                    medium: { cellsToRemove: 45 },
                    hard: { cellsToRemove: 55 }
                };

                this.init();
            }

            init() {
                this.createGrid();
                this.bindEvents();
                this.newGame();
            }

            // åˆ›å»ºæ•°ç‹¬ç½‘æ ¼ DOM
            createGrid() {
                const grid = document.getElementById('sudokuGrid');
                grid.innerHTML = '';

                for (let i = 0; i < 81; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.index = i;
                    grid.appendChild(cell);
                }
            }

            // ç»‘å®šäº‹ä»¶
            bindEvents() {
                // æ ¼å­ç‚¹å‡»äº‹ä»¶
                document.getElementById('sudokuGrid').addEventListener('click', (e) => {
                    if (e.target.classList.contains('cell')) {
                        this.selectCell(parseInt(e.target.dataset.index));
                    }
                });

                // æ•°å­—é”®ç›˜
                document.querySelectorAll('.number-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const number = parseInt(btn.dataset.number);
                        this.inputNumber(number);
                    });
                });

                // é”®ç›˜è¾“å…¥
                document.addEventListener('keydown', (e) => {
                    if (e.key >= '1' && e.key <= '9') {
                        this.inputNumber(parseInt(e.key));
                    } else if (e.key === 'Backspace' || e.key === 'Delete' || e.key === '0') {
                        this.inputNumber(0);
                    }
                });

                // éš¾åº¦é€‰æ‹©
                document.querySelectorAll('.difficulty-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.difficulty = btn.dataset.difficulty;
                        document.getElementById('difficultyDisplay').textContent = btn.textContent;
                        this.newGame();
                    });
                });

                // æŒ‰é’®äº‹ä»¶
                document.getElementById('newGameBtn').addEventListener('click', () => this.newGame());
                document.getElementById('hintBtn').addEventListener('click', () => this.showHint());
                document.getElementById('checkBtn').addEventListener('click', () => this.checkSolution());
            }

            // æ–°æ¸¸æˆ
            newGame() {
                this.errors = 0;
                this.selectedCell = null;
                this.updateErrors();
                this.stopTimer();
                this.startTimer();

                // ç”Ÿæˆå®Œæ•´çš„æ•°ç‹¬
                this.generateSudoku();

                // æ ¹æ®éš¾åº¦ç§»é™¤æ•°å­—
                this.removeNumbers();

                // æ¸²æŸ“æ£‹ç›˜
                this.render();
            }

            // ç”Ÿæˆå®Œæ•´çš„æ•°ç‹¬ï¼ˆå›æº¯ç®—æ³•ï¼‰
            generateSudoku() {
                // åˆå§‹åŒ–ç©ºç™½æ£‹ç›˜
                this.board = Array(9).fill(null).map(() => Array(9).fill(0));

                // å¡«å……å¯¹è§’çº¿çš„ 3x3 å®«æ ¼ï¼ˆå®ƒä»¬ç›¸äº’ç‹¬ç«‹ï¼‰
                for (let i = 0; i < 9; i += 3) {
                    this.fillBox(i, i);
                }

                // å¡«å……å‰©ä½™çš„æ ¼å­
                this.solveSudoku(this.board);

                // ä¿å­˜è§£å†³æ–¹æ¡ˆ
                this.solution = this.board.map(row => [...row]);
            }

            // å¡«å…… 3x3 å®«æ ¼
            fillBox(row, col) {
                const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                this.shuffle(numbers);

                let idx = 0;
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        this.board[row + i][col + j] = numbers[idx++];
                    }
                }
            }

            // æ´—ç‰Œç®—æ³•
            shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            // æ£€æŸ¥æ•°å­—æ˜¯å¦å¯ä»¥æ”¾ç½®
            isValid(board, row, col, num) {
                // æ£€æŸ¥è¡Œ
                for (let x = 0; x < 9; x++) {
                    if (board[row][x] === num) return false;
                }

                // æ£€æŸ¥åˆ—
                for (let x = 0; x < 9; x++) {
                    if (board[x][col] === num) return false;
                }

                // æ£€æŸ¥ 3x3 å®«æ ¼
                const startRow = row - row % 3;
                const startCol = col - col % 3;
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        if (board[startRow + i][startCol + j] === num) return false;
                    }
                }

                return true;
            }

            // æ±‚è§£æ•°ç‹¬ï¼ˆå›æº¯ç®—æ³•ï¼‰
            solveSudoku(board) {
                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 9; col++) {
                        if (board[row][col] === 0) {
                            // å°è¯• 1-9 çš„æ•°å­—
                            const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                            this.shuffle(numbers); // éšæœºåŒ–ä»¥ç”Ÿæˆä¸åŒçš„æ•°ç‹¬

                            for (let num of numbers) {
                                if (this.isValid(board, row, col, num)) {
                                    board[row][col] = num;

                                    if (this.solveSudoku(board)) {
                                        return true;
                                    }

                                    board[row][col] = 0;
                                }
                            }

                            return false;
                        }
                    }
                }
                return true;
            }

            // æ ¹æ®éš¾åº¦ç§»é™¤æ•°å­—
            removeNumbers() {
                const cellsToRemove = this.difficultySettings[this.difficulty].cellsToRemove;
                this.initialBoard = this.board.map(row => [...row]);

                let removed = 0;
                while (removed < cellsToRemove) {
                    const row = Math.floor(Math.random() * 9);
                    const col = Math.floor(Math.random() * 9);

                    if (this.board[row][col] !== 0) {
                        this.board[row][col] = 0;
                        removed++;
                    }
                }

                // ä¿å­˜åˆå§‹æ£‹ç›˜
                this.initialBoard = this.board.map(row => [...row]);
            }

            // é€‰æ‹©æ ¼å­
            selectCell(index) {
                const row = Math.floor(index / 9);
                const col = index % 9;

                // ä¸èƒ½é€‰æ‹©åˆå§‹æ•°å­—
                if (this.initialBoard[row][col] !== 0) {
                    return;
                }

                this.selectedCell = { row, col, index };
                this.render();
            }

            // è¾“å…¥æ•°å­—
            inputNumber(number) {
                if (!this.selectedCell) return;

                const { row, col } = this.selectedCell;

                // æ¸…é™¤
                if (number === 0) {
                    this.board[row][col] = 0;
                    this.render();
                    return;
                }

                // è¾“å…¥æ•°å­—
                this.board[row][col] = number;

                // æ£€æŸ¥æ˜¯å¦æ­£ç¡®
                if (this.solution[row][col] !== number) {
                    this.errors++;
                    this.updateErrors();

                    // çŸ­æš‚æ˜¾ç¤ºé”™è¯¯
                    setTimeout(() => {
                        this.render();
                    }, 500);
                }

                this.render();

                // æ£€æŸ¥æ˜¯å¦å®Œæˆ
                if (this.isComplete()) {
                    this.stopTimer();
                    this.showCelebration();
                }
            }

            // æç¤ºåŠŸèƒ½
            showHint() {
                if (!this.selectedCell) {
                    alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ ¼å­ï¼');
                    return;
                }

                const { row, col } = this.selectedCell;

                if (this.board[row][col] !== 0) {
                    alert('è¿™ä¸ªæ ¼å­å·²ç»æœ‰æ•°å­—äº†ï¼');
                    return;
                }

                // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
                this.board[row][col] = this.solution[row][col];
                this.render();

                // æ£€æŸ¥æ˜¯å¦å®Œæˆ
                if (this.isComplete()) {
                    this.stopTimer();
                    this.showCelebration();
                }
            }

            // æ£€æŸ¥ç­”æ¡ˆ
            checkSolution() {
                let hasErrors = false;

                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 9; col++) {
                        if (this.board[row][col] !== 0 &&
                            this.board[row][col] !== this.solution[row][col]) {
                            hasErrors = true;
                            // ä¸´æ—¶æ ‡è®°é”™è¯¯
                            const index = row * 9 + col;
                            const cell = document.querySelector(`[data-index="${index}"]`);
                            cell.classList.add('error');
                        }
                    }
                }

                if (!hasErrors) {
                    if (this.isComplete()) {
                        this.stopTimer();
                        this.showCelebration();
                    } else {
                        alert('ç›®å‰å¡«å†™çš„éƒ½æ­£ç¡®ï¼Œç»§ç»­åŠ æ²¹ï¼');
                    }
                } else {
                    setTimeout(() => {
                        this.render();
                    }, 1000);
                }
            }

            // æ£€æŸ¥æ˜¯å¦å®Œæˆ
            isComplete() {
                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 9; col++) {
                        if (this.board[row][col] === 0) {
                            return false;
                        }
                    }
                }
                return true;
            }

            // æ¸²æŸ“æ£‹ç›˜
            render() {
                const cells = document.querySelectorAll('.cell');

                cells.forEach((cell, index) => {
                    const row = Math.floor(index / 9);
                    const col = index % 9;
                    const value = this.board[row][col];

                    // æ¸…é™¤æ‰€æœ‰æ ·å¼
                    cell.className = 'cell';
                    cell.textContent = value || '';

                    // åˆå§‹æ•°å­—
                    if (this.initialBoard[row][col] !== 0) {
                        cell.classList.add('initial');
                    }

                    // é€‰ä¸­çš„æ ¼å­
                    if (this.selectedCell && this.selectedCell.index === index) {
                        cell.classList.add('selected');
                    }

                    // é«˜äº®ç›¸åŒè¡Œåˆ—å’Œå®«æ ¼
                    if (this.selectedCell) {
                        const selectedRow = this.selectedCell.row;
                        const selectedCol = this.selectedCell.col;

                        if (row === selectedRow || col === selectedCol) {
                            cell.classList.add('highlighted');
                        }

                        // åŒä¸€ä¸ª 3x3 å®«æ ¼
                        if (Math.floor(row / 3) === Math.floor(selectedRow / 3) &&
                            Math.floor(col / 3) === Math.floor(selectedCol / 3)) {
                            cell.classList.add('highlighted');
                        }
                    }

                    // é«˜äº®ç›¸åŒæ•°å­—
                    if (this.selectedCell && value !== 0) {
                        const selectedValue = this.board[this.selectedCell.row][this.selectedCell.col];
                        if (value === selectedValue) {
                            cell.classList.add('same-number');
                        }
                    }

                    // é”™è¯¯æ ‡è®°
                    if (value !== 0 && this.solution[row][col] !== value) {
                        cell.classList.add('error');
                    }
                });
            }

            // è®¡æ—¶å™¨
            startTimer() {
                this.startTime = Date.now();
                this.timerInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - this.startTime) / 1000);
                    const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
                    const seconds = (elapsed % 60).toString().padStart(2, '0');
                    document.getElementById('timer').textContent = `${minutes}:${seconds}`;
                }, 1000);
            }

            stopTimer() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                }
            }

            // æ›´æ–°é”™è¯¯è®¡æ•°
            updateErrors() {
                document.getElementById('errors').textContent = this.errors;
            }

            // æ˜¾ç¤ºåº†ç¥åŠ¨ç”»
            showCelebration() {
                const elapsed = Math.floor((Date.now() - this.startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;

                const overlay = document.createElement('div');
                overlay.className = 'overlay';

                const celebration = document.createElement('div');
                celebration.className = 'celebration';
                celebration.innerHTML = `
                    <h2>ğŸ‰ æ­å–œå®Œæˆï¼</h2>
                    <p>ç”¨æ—¶: ${minutes}åˆ†${seconds}ç§’</p>
                    <p>é”™è¯¯: ${this.errors}æ¬¡</p>
                    <button class="btn-primary" onclick="location.reload()">å†æ¥ä¸€å±€</button>
                `;

                document.body.appendChild(overlay);
                document.body.appendChild(celebration);

                // äº”å½©çº¸å±‘
                this.createConfetti();

                // ç‚¹å‡»é®ç½©å…³é—­
                overlay.addEventListener('click', () => {
                    overlay.remove();
                    celebration.remove();
                });
            }

            // åˆ›å»ºäº”å½©çº¸å±‘
            createConfetti() {
                const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];

                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * window.innerWidth + 'px';
                        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.animationDelay = Math.random() * 2 + 's';
                        document.body.appendChild(confetti);

                        setTimeout(() => confetti.remove(), 3000);
                    }, i * 50);
                }
            }
        }

        // å¯åŠ¨æ¸¸æˆ
        const game = new SudokuGame();
    </script>
</body>
</html>
